## 一致性协议
### CAP 理论
```
一致性 (Consistency)：一个写操作返回成功，那么之后的读请求都必须读到这个新数据；如果返回失败，那么所有读操作都不能读到这个数据。所有节点访问同一份最新的数据。
可用性 (Availability)：对数据更新具备高可用性，请求能够及时处理，不会一直等待，即使出现节点失效。
分区容错性 (Partition tolerance)：能容忍网络分区，在网络断开的情况下，被分隔的节点仍能正常对外提供服务。
```
### 两/三阶段提交
[两阶段提交](https://zhuanlan.zhihu.com/p/35298019)
### paxos
```
```
### ZAB
#### 崩溃恢复
leader，follow，look,observer
每个节点间和leader节点有心跳检测

当集群初始化和leader节点宕机后，会通过崩溃恢复过程选举新的leader服务器
主要过程为发起投票，决策投票和决策leader：
首先投票信息包括：事务id,任期和服务其id
每个节点先投票自己，然后向其他的节点发起投票，竞选节点收到投票后，与自身的投票信息进行决策比较，如果新投票胜出，则更新本地投票，并广播投票结果到集群，直到决策出某个节点的投票信息超过半数节点结束投票，当前节点作为leader；然后恢复日志，向其他节点告知leader信息，其他节点根据leader信息做出决策，如果事务相同，则直接回复，如果事务小于，则发起复制剩余事务。当集群所有节点的事务一致后集群进入原子广播状态。
#### 原子广播
当leader发起新的事务时，首先会将事务广播到其他following节点,当有半数以上的节点回复已经接受事务后，leader发起提交事务的请求，当有半数的节点回复后，事务完成。保证每个节点的事务一致性。
其所有的新事物必须通过leader 节点发起。


### raft
服务器可能会处于如下三种角色：leader、candidate、follower，正常运行的情况下，会有一个leader，其他全为follower，follower只会响应leader和candidate的请求
[raft流程](https://cloud.tencent.com/developer/article/1826594)
#### leader选举
其为了保证选举的成功性，通过投票前随机延迟时间的方式，让节点投票的时间错开
其leader选举也是通过事务和任期
#### 日志复制
