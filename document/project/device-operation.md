### device operation
1. 简介
``` 
device operation 模块主要能力为提供设备交互代理模块（MQTT设备,sip设备,三方设备），包括数据下行，设备下线，和路由等能力

延迟命令通过pulsar发送延迟消息的方式和springSchedule两种方式分别支持分布式和单机版本

接口主要功能： 
1. 提供了命令相关的查询接口，提供了许多业务层的api接口，包括自定义命令下发，系统命令和下发业务数据和下线设备等。
2. 实现云端与接入层服务的代理交互：
a. 设备代理管理和虚拟关系的转换，和前置check,比如下行设备是否在线等。
b. 真实设备路由表查询，执行下行操作
c. 主要的业务包括命令生命周期管理，命令的周期包括，保存，发送失败，已发送，已响应，响应过期，已完成，执行失败，执行过期；生命周期设置了level,
通过数据库更新不断向上级更新，从而实现生命周期，这里防止了并发的不同level执行数据库时，只会保留最终高级的状态；另外通过caffine缓存
事件自动处理过期事件。另外一个难点是操作服务是分布式的，执行命令只会在一个节点存在缓存，而平台命令周期通过http调用是无法查找到服务的，
此时利用pulsar事件广播通知能力，既解耦了http调用，还能通过每个节点接受事件根据本地缓存过滤是否对事件进行处理。

平台命令执行过期时间默认最大值为1H，防止出现缓存的命令事件过多，导致内存不够

平台命令通过雪花算法生成命令ID: 雪花算法
long 一共64位
首位为0，表示正数
时间戳一共41位  ： timestamp<<22
数据中心12位：datacenter << 15,workId<< 10
序列号： 同一秒生成的序列号10 位

如何解决时钟回拨问题：
服务始终保存最新的一个id，如果存在生成的id小于当前id时，出现时钟回拨；
1. 直接服务报错，不提供服务，发送邮件通知
2. 可以解析当前id，得到时间戳，数据中心和序列号，发送通知并在序列号上进行添加
3. 时间戳中预留n位用于一定时间内的回拨
```